<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xml:lang="en" lang="en">


<!--<h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>-->

<h:head>
    <title>Unos / Ažuriranje događaja</title>

</h:head>

<h:body>
    <form id="logout" action="ibm_security_logout" method="post">
        <p:menubar style="background-color: #a6cbfa; color: black">
            <p:menuitem value="Početna"
                        icon="pi pi-fw pi-home"
                        url="http://localhost:9080/online-events/welcome.xhtml"
                        style="color: black; font-size:larger; font-weight:600"/>

            <p:menuitem value="Pretraga/pregled"
                        icon="pi pi-fw pi-filter"
                        url="http://localhost:9080/online-events/secured/user/pregledDogadaja.xhtml"
                        rendered="#{request.isUserInRole('admin') or request.isUserInRole('organizer') or request.isUserInRole('user')}"
                        style="color: black; font-size:larger; font-weight:600"/>

            <p:menuitem value="Unos/Ažuriranje"
                        icon="pi pi-fw pi-calendar-plus"
                        url="http://localhost:9080/online-events/secured/admin/upravljanjeDogadajima.xhtml"
                        rendered="#{request.isUserInRole('admin') or request.isUserInRole('organizer')}"
                        style="color: black; font-size:larger; font-weight:600"/>

            <p:menuitem value="Korisnici"
                        icon="pi pi-fw pi-user-plus"
                        url="http://localhost:9080/online-events/secured/super-admin/pregledKorisnika.xhtml"
                        rendered="#{request.isUserInRole('admin')}"
                        style="color: black; font-size:larger; font-weight:600"/>

            <f:facet name="options">
                <span class="ui-input-icon-left">
                    <h:form id="userDialogForm">
                     <p:commandButton value="#{request.remoteUser}"
                                      icon="pi pi-fw pi-user-edit"
                                      styleClass="rounded-button ui-button-info" ajax="true"
                                      onclick="PF('includedDialog').show();"
                     />

                    </h:form>
                </span>
                <input type="hidden" name="logoutExitPage" value="/welcome.xhtml"/>
                <p:button value="Odjava"
                          icon="pi pi-fw pi-sign-out"
                          styleClass="rounded-button ui-button-secondary"
                          onclick="document.getElementById('logout').submit()"/>
            </f:facet>

        </p:menubar>
    </form>


    <h:form id="mainForm">
        <div>
            <h1>
                Unos i ažuriranje događaja
            </h1>
        </div>

        <h:panelGrid>
            <p:messages id="messages" showDetail="true" closable="true">
                <p:autoUpdate/>
            </p:messages>
        </h:panelGrid>

        <div class="card">
            <p:dataTable id="dogadaji_table"
                         widgetVar="dogadajiTable"
                         var="dogadajDto"
                         rows="5"
                         value="#{dogadajiController.dogadajiFilterList}"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                         rowsPerPageTemplate="5,10,15"
                         selectionMode="single"
                         paginatorPosition="bottom"
                         rowKey="#{dogadajDto.sifraDogadaja}"
                         emptyMessage="Nije pronađen niti jedan događaj"
                         filteredValue="#{dogadajiController.dogadajiFilteredList}"
            >
                <f:facet name="header">
                    <div>
                        <span style="font-weight: bold">Pregled događaja</span>
                    </div>
                </f:facet>
                <p:column headerText="Šifra" filterBy="#{dogadajDto.sifraDogadaja}" filterMatchMode="contains">
                    <h:outputText value="#{dogadajDto.sifraDogadaja}"/>
                </p:column>
                <p:column headerText="Naziv" filterBy="#{dogadajDto.nazivDogadaja}" filterMatchMode="contains">
                    <h:outputText value="#{dogadajDto.nazivDogadaja}"/>
                </p:column>

                <p:column headerText="Tip" filterBy="#{dogadajDto.tipDogadaja}" filterMatchMode="exact">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dogadajiTable').filter()" styleClass="custom-filter">
                            <f:selectItem itemLabel="-" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{dogadajiController.tipDogadajaFilterSelectItems}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{dogadajDto.tipDogadajaNaziv}" styleClass="#{dogadajDto.tipDogadaja == 1 ? 'glazba' :  dogadajDto.tipDogadaja == 2 ? 'kultura' :
                                        dogadajDto.tipDogadaja == 3 ? 'sport' : dogadajDto.tipDogadaja == 4 ? 'posao' : 'ostalo'}"/>
                </p:column>

                <p:column headerText="Vrijeme od" filterBy="#{dogadajDto.vrijemeOd}" filterMatchMode="contains">
                    <h:outputText value="#{dogadajDto.vrijemeOd}">
                        <f:converter converterId="LocalDateConverter"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Vrijeme do" filterBy="#{dogadajDto.vrijemeDo}" filterMatchMode="contains">
                    <h:outputText value="#{dogadajDto.vrijemeDo}">
                        <f:converter converterId="LocalDateConverter"/>
                    </h:outputText> </p:column>
                <p:column headerText="Ulaz slobodan" filterBy="#{dogadajDto.slobodanUlaz}" filterMatchMode="exact">

                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dogadajiTable').filter()" styleClass="custom-filter">
                            <f:selectItems value="#{dogadajiController.slobodanUlazFilterSelectItems}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{dogadajDto.slobodanUlaz}"/>
                </p:column>
                <p:column headerText="Grad"
                          filterBy="#{dogadajDto.gradDogadajaDto.nazivGrada}">
                    <h:outputText value="#{dogadajDto.gradDogadajaDto.nazivGrada}"/>
                </p:column>

                <p:column headerText="Županija"
                          filterBy="#{dogadajDto.gradDogadajaDto.organizacijskaJedinicaDto.nazivOrgJedinice}">
                    <h:outputText
                            value="#{dogadajDto.gradDogadajaDto.organizacijskaJedinicaDto.nazivOrgJedinice}"/>
                </p:column>
                <p:column headerText="Kreator"
                          filterBy="#{dogadajDto.kreatorDogadaja.korisnickoIme}">
                    <h:outputText
                            value="#{dogadajDto.kreatorDogadaja.korisnickoIme}"/>
                </p:column>
                <p:column headerText="Akcija" exportable="false">
                    <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" title="Izbriši događaj"
                                     rendered="#{dogadajDto.kreatorDogadaja != null and dogadajDto.kreatorDogadaja.korisnickoIme.equals(request.remoteUser) }"
                                     actionListener="#{dogadajiController.deleteDogadaj(request.remoteUser, dogadajDto.sifraDogadaja)}"
                                     update="mainForm"
                    >
                        <p:confirm type="popup" header="Confirmation"
                                   message="Jeste li sigurni da želite izbrisati događaj?" icon="pi pi-info-circle"/>
                    </p:commandButton>
                    <p:confirmPopup global="true">
                        <p:commandButton value="Ne" type="button" styleClass="ui-confirm-popup-no ui-button-flat"/>
                        <p:commandButton value="Da" type="button" styleClass="ui-confirm-popup-yes"/>
                    </p:confirmPopup>
                </p:column>
            </p:dataTable>
        </div>


        <p:dialog global="true" id="test" widgetVar="includedDialog" header="Moji podaci" showEffect="explode">
            <ui:include src="/secured/user/korisnikInfo.xhtml"/>
        </p:dialog>

    </h:form>
</h:body>

<style type="text/css">
    .sport {
        background-color: #b4ea85 !important;
        background-image: none !important;
        color: #1d3705 !important;

    }

    .kultura {
        background-color: #ecb97b !important;
        background-image: none !important;
        color: #452a08 !important;
    }

    .glazba {
        background-color: #fc8d8d !important;
        background-image: none !important;
        color: #400a0a !important;
    }

    .posao {
        background-color: #8ceae7 !important;
        background-image: none !important;
        color: #0b2624 !important;
    }

    .ostalo {
        background-color: #838282 !important;
        background-image: none !important;
        color: #242424 !important;
    }
</style>
</html>